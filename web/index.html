<html>
  <head>
    <link href='bootstrap/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400;300' rel='stylesheet' type='text/css'>
    <link href='cssFiles/custom.css' rel='stylesheet'>
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css' rel='stylesheet' />

    
  </head>
  <body>

    <div style="left: 0px;" class="menu">
      
      <!-- Menu icon -->
      <div class="icon-close">
        <img src="images/close_button.png">
      </div>

      <!-- Menu -->
      <ul>
        <li class="rowx"><a href="#">Home</a></li>
        <li class="rowx"><a href="#">Customers</a></li>
        <li class="rowx"><a href="#">Rewards</a></li>
        <li class="rowx"><a href="#">Map</a></li>
        <li class="rowx"><a href="#">Sign Out</a></li>
      </ul>

    </div>


   

    <!-- Main Body -->
    <div class="jumbotron">
      <div class="icon-menu">
        <i class="fa fa-bars"></i>
        Menu
      </div>

      <div class="Welcome">
      		prototype
      </div>
      
      <div class="centre-body home">
        <div class="row">
          <div class="main-topic1">
            <div class="growcol1">
              <p>RFID Checkins Today</p>
              <div class="totalCheckin"></div>
            </div>
          </div>
          <div class="main-topic2">
            <div class="growcol1">
              <p>Loyal Customer Checkins Today</p>
              			<table class="table checkinTableStyle">
			      <thead>
			        <tr>
			          <th>Customer Name</th>
			          <th>Last Location</th>
			          <th># Previous Checkins</th>
			        </tr>
			      </thead>
			      <tbody class="checkinTable">
			        <tr>
			          <td>Donald Trump</td>
			          <td>Whistler Blackbomb</td>
			          <td>16</td>
			        </tr>
			        <tr>
			          <td>Lebron James</td>
			          <td>Garfinkels</td>
			          <td>13</td>
			        </tr>
			      </tbody>
			    </table>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="main-topic3">
            <div class="growcol1">
              <p>Most Active RFID Location Today</p>
              <div class="activeLocation">1. Hotel Entrance</div>
              <div class="activeLocation">2. Bakery</div>
              <div class="activeLocation">3. Lounge</div>
            </div>
          </div>
          <div class="main-topic4">
            <div class="growcol1">
              <p>Latest Checkins Today</p>
              			<table class="table checkinTableStyle">
			      <thead>
			        <tr>
			          <th>Customer Name</th>
			          <th>Last Location</th>
			          <th>Minutes Ago</th>
			        </tr>
			      </thead>
			      <tbody class="checkinTable">
			        <tr>
			          <td>Eric Grayson</td>
			          <td>Bakery</td>
			          <td>10</td>
			        </tr>
			        <tr>
			          <td>Laferty Daniels</td>
			          <td>Big Boy Bar</td>
			          <td>25</td>
			        </tr>
			      </tbody>
			    </table>
            </div>
          </div>
        </div>
      </div>

      <div style="display:none"class="centre-body customers">
			<table class="table">
			      <thead>
			        <tr>
			          <th>#</th>
			          <th>Customer Name</th>
			          <th>Room Number</th>
			          <th>Current Temp</th>
			          <th>Previous Temperature</th>
			          <th>Humidity</th>
			        </tr>
			      </thead>
			      <tbody class="roomTable">
			        <tr>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			           <td></td>
			        </tr>
			        <tr>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			        </tr>
			        <tr>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			          <td></td>
			        </tr>
			      </tbody>
			    </table>
      </div>

	  <div style="display:none"class="centre-body rewards">
	  		<p>Available Gifts: <span class="numGifts">8</span></p>
	  		<p>Top Customers: <p>
			<table class="table">
			      <thead>
			        <tr>
			          <th>Customer Name</th>
			          <th>Favourite Whistler Location</th>
			          <th># Repeat Visits</th>
			        </tr>
			      </thead>
			      <tbody class="giftsTable">
					<tr>
			          <td>Donald Trump</td>
			          <td>Whistler Blackcomb</td>
			          <td>16</td>
			          <td><a class="alertGift">assign gift</a></td>
			        </tr>
					<tr>
			          <td>Lebron James</td>
			          <td>Garfinkels</td>
			          <td>13</td>
			          <td><a class="alertGift">assign gift</a></td>
			        </tr>
			        <tr>
			          <td>Morgan Stanley</td>
			          <td>Grill Steakhouse</td>
			          <td>10</td>
			          <td><a class="alertGift">assign gift</a></td>
			        </tr>
			      </tbody>
			    </table>
      </div>

      <div style="display:none"class="centre-body map">
      		<p>Map Box</p>
      		<iframe width='100%' height='500px' frameBorder='0' src='https://a.tiles.mapbox.com/v4/kennych.ja00ofij/attribution,zoompan,zoomwheel,geocoder,share.html?access_token=pk.eyJ1Ijoia2VubnljaCIsImEiOiJZS1lpMGZnIn0.3aPCBS81FCRdMhltfO-YIg'></iframe>

      </div>

    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
		$(function() {


	$.ajax({
		url: "http://184.65.136.142:8080/foresight_api/Recently_Scanned/?format=json",
		type: "GET",
		data: "",
		dataType: 'json',
		async: true,

		success: function(data)
		{
			var rfidDataList = [];
			addObjectToRfidDataList(rfidDataList, data);

			var infoList = [];
			for(var i = 0; i < rfidDataList.length; i++) {
				displayPerson(rfidDataList[i]);
			}
		}
	});

function addObjectToRfidDataList(rfidDataList, data) {

  for(var i = 0; i < data.length; i++) {
   var obj = data[i];
   var rfidDataToAdd = {'RFID': obj.RFID, 'timestamp': obj.timestamp};
   if(!contains(rfidDataList, obj.RFID)) {
    rfidDataList.push(rfidDataToAdd);
   }
   // console.log(obj);
  }
  
 }

 function contains(array, rfid) {
  for(var i = 0; i < array.length; i++) {
   if(array[i].RFID === rfid) {
    return true;
   }
  }
  return false;
 }

	function displayPerson(rfidData) {
		// Grab information for first and last name using
		// ajax call based on RFID
		var rfid = rfidData['RFID'];
		$.ajax({
			url: "http://184.65.136.142:8080/foresight_api/Users/?format=json",
			type: "GET",
			data: "RFID: " + rfid,
			dataType: 'json',
			async: true,
			success: function(data)
			{
				var person = [];
				for(var i = 0; i < data.length; i++) {
					var obj = data[i];
					var timestamp = rfidData['timestamp'];
					var personInfo = {'firstName': obj.firstName, 'lastName': obj.lastName, 'timestamp': timestamp};

					// if not a duplicate
					if(!contains(person, personInfo)) {
						person.push(personInfo);
					}

					if(person.length === 11) {
						person.shift();
					}
				}
				console.log(person);
			}
		});

	}

		function roomTable(){
		//	if(data!=null){
		  		//template_rows = data[data_type].length;
		  		//tbody = $('.roomTable').html("APPLE");

			$.ajax({                                      
				url: "http://184.65.136.142:8080/foresight_api/Latest_RD/?user_id=1", 
				type: "GET",
				data: "",
				dataType: 'json',
				async: true,
				
				success: function(data) 
				{
					data = JSON.parse(data);
					console.log(data[0]['fields']);
					data2 = 
					data = data[0]['fields'];
					console.log(data);

					if(data!=null){
				  		template_rows = data.length;
				  		template_tbody = '<tr>' + '<td>' + data.user_id+'</td>'+'<td>' + 'Jeffrey Morgan'+ '</td>' + '<td>' + data.roomNum + '</td>' + '<td>' + data.temp/10 + ' &#8451;'+'</td>' + '<td>' + ((data.humidityTemp/100) - 1) +' &#8451;'+ '</td>'+'<td>' + data.humidityPercentage/100 +'%' + '</td>' +'</tr>';	
				  		console.log(template_tbody);
				  		$(('.roomTable')).html(template_tbody);
				  	}
				  	else{
				  		$(('.roomTable')).html("");
				  	}



				}
			});
		  //}
		}


			$('.rowx').click(function(element) {
				x= $('.rowx');
				console.log(x);
				for(i = 0;i<x.length;i++){
					x[i].className="rowx";

				}
				element.currentTarget.className="rowx rowxselected";
				lowerC=element.currentTarget.textContent.toLowerCase();
				console.log(lowerC);
				if(lowerC=="home"){
					$('.home').show();
					$('.customers').hide();
					$('.rewards').hide();
					$('.map').hide();
				}
				if(lowerC=="customers"){
					$('.home').hide();
					$('.customers').show();
					$('.rewards').hide();
					$('.map').hide();
					roomTable();
				}
				if(lowerC=="rewards"){
					$('.home').hide();
					$('.customers').hide();
					$('.rewards').show();
					$('.map').hide();
					$( ".alertGift" ).click(function() {
					  //alert("Notification Sent");
					  // alert($('.numGifts').html()-1);
					   newNum = $('.numGifts').html()-1;
					   $('.numGifts').html(newNum);
					  //alert($('.numGifts').html());
					});

				}
				if(lowerC=="map"){
					$('.home').hide();
					$('.customers').hide();
					$('.rewards').hide();
					$('.map').show();
				}
			  console.log(element);
			});




			$.ajax({                                      
				url: "http://184.65.136.142:8080/foresight_api/Users/?format=json", 
				type: "GET",
				data: "",
				dataType: 'json',
				async: true,
				
				success: function(data) 
				{
					
					console.log(data);
					counter = data.length;
					console.log(counter);
					$(".totalCheckin").html(counter);
					//data = JSON.parse(data);
					//console.log(data[0]['fields']['RFID']);
				}
			});

			
		});

    </script>
    <script src="jsFiles/app.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>

  </body>
</html>